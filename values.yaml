replicaCount: 3

image:
  repository: emqx/emqx
  tag: "5.6"
  pullPolicy: IfNotPresent

service:
  type: NodePort
  externalTrafficPolicy: Cluster
  ports:
    mqtt:
      enabled: true
      port: 1883
      nodePort: 30483
    mqtts:
      enabled: true
      port: 8883
      nodePort: 32426
    ws:
      enabled: true
      port: 8083
      nodePort: 31816
    dashboard:
      enabled: true
      port: 18083
      nodePort: 30825

persistence:
  enabled: true
  size: 20Gi
  storageClass: standard
  accessModes: ["ReadWriteOnce"]

emqxConfig:
  # Node cookie for clustering
  EMQX_NODE__COOKIE: "super-secret-cookie"

  # Kubernetes-based cluster discovery
  EMQX_CLUSTER__DISCOVERY_STRATEGY: "k8s"
  EMQX_CLUSTER__K8S__NAMESPACE: "emqx"
  EMQX_CLUSTER__K8S__SERVICE_NAME: "my-emqx-headless"  # Must match headless service
  EMQX_CLUSTER__K8S__SUFFIX: "svc.cluster.local"
  EMQX_CLUSTER__K8S__ADDRESS_TYPE: "ip"

  # Node distribution port
  EMQX_DISTRIBUTION__LISTEN__PORT: "4370"

resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "2"
    memory: "4Gi"

livenessProbe:
  enabled: true
  httpGet:
    path: /status
    port: 18083
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6

readinessProbe:
  enabled: true
  httpGet:
    path: /status
    port: 18083
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
